#!/usr/bin/env ruby
require 'daemons'

controller = Megaleech::TorrentsController.new
Daemons.run_proc("megaleech") do
  loop do
    system "ssh -R #{Megaleech.client_port}:localhost:22 #{Megaleech.remote_user}@#{Megaleech.remote_host} \"MEGALEECH_USER=#{Megaleech.client_user} MEGALEECH_PORT=#{Megaleech.client_port} MEGALEECH_DESTINATION=#{Megaleech.client_download_directory} megaleech_server download \""
    sleep(300)
  end
end